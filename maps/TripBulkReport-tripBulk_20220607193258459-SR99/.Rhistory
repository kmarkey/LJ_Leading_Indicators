plot.caption = element_text(color = white, face = "bold", hjust = 1),
plot.background = element_rect(fill = blue),
strip.background = element_blank(),
strip.text = element_text())}
theme_set(ljtheme())
# ############### not 0 days #############################################
#top 10 mhd 14+
mhd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 mhd14+
mhd14bottom <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
#plot together
bind_rows(mhd14top, mhd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had More Than 0 Bad Mental Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# top 10 phd14+
phd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phd14top, phd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had 14+ Bad Physical Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# how many faclities per state?
n1 %>%
dplyr::select(TOT, name) %>%
distinct() %>%
arrange(desc(TOT)) %>%
head(10)
# how many eper capita?
n1 %>%
left_join(pop, by = "name") %>%
dplyr::select(TOT, name, pop) %>%
dplyr::mutate(per_capita = TOT/pop) %>%
distinct() %>%
arrange(desc(per_capita)) %>%
head(10)
#top 10 mhd 14+
mhd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d == "14+", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 mhd14+
mhd14bottom <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d == "14+", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
#plot together
bind_rows(mhd14top, mhd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had 14+ Bad Mental Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# chloropleth
us_states <- map_data("state")
data <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d == "14+", 1, 0))/n()) %>%
distinct() %>%
right_join(us_states, by = c("name" = "region"))
p <- ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
# add nmhss data
data <- n1 %>%
dplyr::select(name, TOT) %>%
distinct() %>%
left_join(us_states, by = c("name" = "region")) %>%
left_join(pop, by = c("name"))
q <- ggplot(data, aes(x = long, y = lat,
group = group, fill = TOT/pop)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Rate", title = "Number of Mental Health Facilities per Capita",
caption = "Data provided by SAHMSA.gov") +
scale_fill_continuous(labels = comma) +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
# for at least 1
data <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d != "0", 1, 0))/n()) %>%
distinct() %>%
right_join(us_states, by = c("name" = "region"))
r <- ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had at \nLeast 1 Bad Mental Health Day",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
grid.arrange(p, q, r, nrow = 2)
# top 10 phd14+
phd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d == "14+", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d == "14+", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phd14top, phd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had 14+ Bad Physical Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# chloropleth
us_states <- map_data("state")
data <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d == "14+", 1, 0))/n()) %>%
distinct() %>%
right_join(us_states, by = c("name" = "region"))
p <- ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
data <- n1 %>%
dplyr::select(name, TOT) %>%
distinct() %>%
left_join(us_states, by = c("name" = "region")) %>%
left_join(pop, by = c("name"))
q <- ggplot(data, aes(x = long, y = lat,
group = group, fill = TOT/pop)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Rate", title = "Number of Mental Health Facilities per Capita",
caption = "Data provided by SAHMSA.gov") +
scale_fill_continuous(labels = comma) +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
# for at least 1
data <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d != "0", 1, 0))/n()) %>%
distinct() %>%
right_join(us_states, by = c("name" = "region"))
r <- ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had at \nLeast 1 Bad Mental Health Day",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
grid.arrange(p, q, r, nrow = 2)
# how many faclities per state?
n1 %>%
dplyr::select(TOT, name) %>%
distinct() %>%
arrange(desc(TOT)) %>%
head(10)
# how many eper capita?
n1 %>%
left_join(pop, by = "name") %>%
dplyr::select(TOT, name, pop) %>%
dplyr::mutate(per_capita = TOT/pop) %>%
distinct() %>%
arrange(desc(per_capita)) %>%
head(10)
#top 10 mhd 14+
mhd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d == "14+", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 mhd14+
mhd14bottom <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d == "14+", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
#plot together
bind_rows(mhd14top, mhd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had 14+ Bad Mental Health Days",
subtitle = "By State, Top 10 and Bottom 10", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# chloropleth
us_states <- map_data("state")
data <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d == "14+", 1, 0))/n()) %>%
distinct() %>%
right_join(us_states, by = c("name" = "region"))
p <- ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
# add nmhss data
data <- n1 %>%
dplyr::select(name, TOT) %>%
distinct() %>%
left_join(us_states, by = c("name" = "region")) %>%
left_join(pop, by = c("name"))
q <- ggplot(data, aes(x = long, y = lat,
group = group, fill = TOT/pop)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Rate", title = "Number of Mental Health Facilities per Capita",
caption = "Data provided by SAHMSA.gov") +
scale_fill_continuous(labels = comma) +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
# for at least 1
data <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d != "0", 1, 0))/n()) %>%
distinct() %>%
right_join(us_states, by = c("name" = "region"))
r <- ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had at \nLeast 1 Bad Mental Health Day",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
grid.arrange(p, q, r, nrow = 2)
# top 10 phd14+
phd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d == "14+", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d == "14+", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phd14top, phd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had 14+ Bad Physical Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# ############### not 0 days #############################################
#top 10 mhd 14+
mhd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 mhd14+
mhd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
#plot together
bind_rows(mhd14top, mhd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had More Than 0 Bad Mental Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# top 10 phd14+
phd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phd14top, phd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had 14+ Bad Physical Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# ############### not 0 days #############################################
#top 10 mhd 14+
mhdn0top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 mhd14+
mhdn0bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
#plot together
bind_rows(mhdn0top, mhdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had At Least 1 Bad Mental Health Day",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# top 10 phd14+
phdn0top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phdn0bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phdn0top, phdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had At Least 1 Bad Physical Health Day",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
#plot together
bind_rows(mhdn0top, mhdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had \nAt Least 1 Bad Mental Health Day",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# plot together
bind_rows(phdn0top, phdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had \nAt Least 1 Bad Physical Health Day",
subtitle = "By State, Top 10 and Bottom 10", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
#plot together
bind_rows(mhdn0top, mhdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had \nAt Least 1 Bad Mental Health Day",
subtitle = "By State, Top 10 and Bottom 10", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
gc()
#Please modify the chunk set up as you wish, some options are in # below
knitr::opts_chunk$set(fig.align = "center",
out.width = "90%",
out.height = "70%",
dpi = 600,
dev = 'png')
#Add packages
library(tidyverse)
library(cowplot)
library(ggridges)
library(kableExtra)
library(usmap)
library(corrplot)
library(readxl)
library(scales)
library(gridExtra)
library(ggrepel)
#Set universal theme + palette for figures
pal <- c("#f6aa1c","#08415c","#6b818c","#eee5e9","#ba7ba1","#c28cae","#a52a2a")
blue <- "#114482"
lightblue <- "#146ff8"
llightblue <- "#AFCFFF"
red <- "#a52a2a"
white <- "#FBFFF1"
yellow <- "#F6AA1C"
ljtheme <- function(){
theme_minimal() %+replace%
theme(
panel.grid.major = element_line(linetype = "solid", color = llightblue, size = 0.1),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = white), #light
panel.border = element_rect(color = lightblue, fill = NA, linetype = "solid", size = 2),
legend.background = element_rect(fill = white, color = lightblue, size = 1), # legend
legend.text = element_text(color = blue),
legend.title = element_text(face = "bold.italic", color = blue),
legend.position = "bottom",
legend.key = element_rect(fill = white),
text = element_text(color = white),
axis.title = element_text(face = "italic", size = 11, color = white),
axis.text = element_text(color = white, size = 9),
axis.ticks = element_line(color = white, size = .5, lineend = "butt"),
axis.ticks.length = unit(.1, "cm"),
plot.title = element_text(face = "bold", # labels
color = white, size = 14, hjust = 0, vjust = 1.5),
plot.subtitle = element_text(color = white, hjust = 0, vjust = 1.5, face = "italic"),
plot.caption = element_text(color = white, face = "bold", hjust = 1),
plot.background = element_rect(fill = blue),
strip.background = element_blank(),
strip.text = element_text())}
theme_set(ljtheme())
suppressWarnings(
source("digest.R", print.eval = FALSE))
# state
suppressWarnings(
source("agegroupjoin.R", print.eval = FALSE))
View(n1)
which(iris$Species  == "Setosa")
iris[,iris$Species  == "Setosa"]
data("iris")
iris[,iris$Species  == "Setosa"]
unique(iris$Species)
iris[,iris$Species  == "setosa"]
iris[iris$Species == "setosa",]
which(iris[,iris$Species  == "setosa"])
which(iris$Species  == "setosa")
source("~/LocalRStudio/mhealth352/digest.R", echo=TRUE)
library(sqldf)
install.packages("sqldf")
sqldf('SELECT age, circumference FROM Orange WHERE Tree = 1 ORDER BY circumference ASC')
library(sqldf)
sqldf('SELECT age, circumference FROM Orange WHERE Tree = 1 ORDER BY circumference ASC')
getwd()
setwd("~/LocalRStudio/LJ_Leading_Indicators/maps)
sqldf('SELECT age, circumference FROM Orange WHERE Tree = 1 ORDER BY circumference ASC')
setwd("~/LocalRStudio/LJ_Leading_Indicators/maps")
setwd("~/LocalRStudio/LJ_Leading_Indicators/maps")
setwd("~/LocalRStudio/LJ_Leading_Indicators/maps/TripBulkReport-tripBulk_20220607193258459-SR99/")
sqldf('SELECT * FROM through.csv')
library(tidyverse)
through <- read_csv("through.csv")
through <- read_csv("data/through.csv")
trips <- read_csv("data/trips.csv")
waypoints <- read_csv("data/waypoints.csv")
sqldf('SELECT * FROM through')
View(through)
View(trips)
through <- read_csv("data/through.csv", headers = FALSE)
trips <- read_csv("data/trips.csv")
through <- read_csv("data/through.csv", col_names =  = FALSE)
through <- read_csv("data/through.csv", col_names = FALSE)
View(through)
throughheads <- read_csv("schema/TripBulkReportThroughHeaders.csv")
View(throughheads)
throughheads <- read_csv("schema/TripBulkReportThroughHeaders.csv", col_names = FALSE)
through <- read_csv("data/through.csv", col_names = throughheads)
View(through)
throughheads <- read_delim("schema/TripBulkReportThroughHeaders.csv", col_names = FALSE)
throughheads <- read_delim("schema/TripBulkReportThroughHeaders.csv") %>%
as.array()
throughheads <- read_delim("schema/TripBulkReportThroughHeaders.csv") %>%
names()
through <- read_csv("data/through.csv", col_names = throughheads)
View(through)
tripheads <- read_delim("schema/TripBulkReportTripsHeaders.csv") %>%
names()
waypointheads <- read_delim("schema/TripBulkReportWaypointsHeaders.csv") %>%
names()
trips <- read_csv("data/trips.csv", col_names = tripheads)
waypoints <- read_csv("data/waypoints.csv", col_names = waypointheads)
View(waypoints)
