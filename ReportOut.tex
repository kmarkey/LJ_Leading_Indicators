% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Leading Indicators for LJ Kirkland},
  pdfauthor={Keaton Markey},
  colorlinks=true,
  linkcolor={Maroon},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={blue},
  pdfcreator={LaTeX via pandoc}}

\title{Leading Indicators for LJ Kirkland}
\usepackage{etoolbox}
\makeatletter
\providecommand{\subtitle}[1]{% add subtitle to \maketitle
  \apptocmd{\@title}{\par {\large #1 \par}}{}{}
}
\makeatother
\subtitle{First Report}
\author{Keaton Markey}
\date{12 January, 2023}

\begin{document}
\maketitle

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{6}
\tableofcontents
}
\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## here() starts at C:/Users/keato/Documents/LocalRStudio/LJ_Leading_Indicators
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(lubridate)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: timechange
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'lubridate'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     date, intersect, setdiff, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'dplyr'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     filter, lag
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(logger)}
\FunctionTok{library}\NormalTok{(here)}
\FunctionTok{library}\NormalTok{(scales)}
\FunctionTok{library}\NormalTok{(tidyr)}
\FunctionTok{library}\NormalTok{(readr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'readr'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:scales':
## 
##     col_factor
\end{verbatim}

\hypertarget{project-aim}{%
\subsubsection{Project Aim:}\label{project-aim}}

Find external indicators that provide reliable insight into previous
business performance of the Lee Johnson Auto Family's Kirkland location,
and use those indicators to predict future business performance.

\hypertarget{digest-a-prepare-data}{%
\section{1. Digest a Prepare Data}\label{digest-a-prepare-data}}

Raw sales data provided by LJ Auto Family has been summarized by month.

\hypertarget{find-indicators}{%
\section{2. Find Indicators}\label{find-indicators}}

Potential candidates were chosen from a pool of 68 stocks, economic
measures, information available from Google Trends, and internal
appointment information. The candidates came from suggestions by Tod,
other similar projects, and current market research.

Candidate selection is not only one of the primary goals of this
project, but it is an important step in preventing issues that may arise
later. In general, one of the most chief concerns when training Machine
Learning models is that the model performs well on the set of training
data, but performs poorly when predicting new data. Among those in the
field, this is known as \emph{overfitting}. It is especially a concern
in this project due to the small amount of available samples and small
scope of data. Reducing the number of candidates used in each model
through a (sometimes) model-specific process called \emph{feature
selection} is a great way to avoid \emph{overfitting}.

Indicators and their associated models can be found in the
\protect\hyperlink{Dataux5cux2520Sources}{Data Sources} section.

Indicators were identified using a variety of \emph{feature selection}
techniques: - correlation coefficient - Lasso L1 regularization -
Permutation Feature Importance

After compiling a list of suggested candidates, I excluded those that
were: - Updated less frequently than every month - Not released before
the 5th of the month - Not available for the duration of LJ data
(2010-present)

\hypertarget{create-predictions}{%
\section{3. Create Predictions}\label{create-predictions}}

After vetting each candidate, they were assembled into a dataset and
given to each of the following models: a) Linear Model with L1
regularization b) Decision Tree c) Random Forest d) LSTM e) Composite
Model

Each model utilizes different algorithms to establish a relationship
between the input and output. Thus, they must be interpreted
differently. Below I describe some of the ways each model should
generally be interpreted, and some additional considerations with
respect to this project.

\hypertarget{linear-model-with-l1-regularization}{%
\subsubsection{Linear Model with L1
regularization}\label{linear-model-with-l1-regularization}}

\hypertarget{decision-tree}{%
\subsubsection{Decision Tree}\label{decision-tree}}

\hypertarget{random-forest}{%
\subsubsection{Random Forest}\label{random-forest}}

\hypertarget{lstm}{%
\subsubsection{LSTM}\label{lstm}}

\hypertarget{ensemble-model}{%
\subsubsection{Ensemble Model}\label{ensemble-model}}

\hypertarget{figure-appendix}{%
\section{4. Figure Appendix}\label{figure-appendix}}

\hypertarget{indicator-index}{%
\section{5. Indicator Index}\label{indicator-index}}

\hypertarget{digestion}{%
\subsection{1. Digestion}\label{digestion}}

After processing LJ data, all external indicators are fetched from the
following sources and API packages monthly:

\begin{itemize}
\tightlist
\item
  Quandl
\item
  AlphaVantage

  \begin{itemize}
  \tightlist
  \item
    with the alpha\_vantage library
  \end{itemize}
\item
  Google Trends

  \begin{itemize}
  \tightlist
  \item
    with the pytrends library
  \end{itemize}
\item
  St.~Louis Federal Reserve
\end{itemize}

This report should be generated on the \textbf{1st of each month}

Each source is lagged 2, 3, 6, and 12 months.

\hypertarget{indicators}{%
\subsection{2. Indicators}\label{indicators}}

Each source file contains multiple candidates. Each candidate is
evaluated separately for simple correlation with respect to the target
metric. Any candidate that does not meet the correlation threshold is
eliminated as the first pass of feature selection.

Features are further selected for each model independently in the
following ways:

\begin{itemize}
\item
  Linear Model

  \begin{itemize}
  \tightlist
  \item
    Each remaining feature is passed through a Lasso regularization
    process, which selects features based on the efficacy of linear
    models that contain them using 5-fold cross-validation.
  \end{itemize}
\item
  Decision Tree

  \begin{itemize}
  \tightlist
  \item
    Regularization is applied after training when the tree is pruned at
    a depth optimized by 5-fold cross-validation.
  \end{itemize}
\item ~
  \hypertarget{random-forest-1}{%
  \subsection{Random Forest}\label{random-forest-1}}
\end{itemize}

A simple correlation is calculated for each source with respect to the
target metric. Based on

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{new\_used }\OtherTok{\textless{}{-}} \StringTok{"NEW"}
\NormalTok{purchase\_lease }\OtherTok{\textless{}{-}} \StringTok{"L"}
\NormalTok{metric }\OtherTok{\textless{}{-}} \StringTok{"n"}
\NormalTok{group }\OtherTok{\textless{}{-}} \StringTok{"weekly"} \CommentTok{\# day, quarter and year?}

\NormalTok{group\_unit }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(group) \{}
  \ControlFlowTok{if}\NormalTok{ (group }\SpecialCharTok{==} \StringTok{"daily"}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(}\StringTok{"day"}\NormalTok{)}
\NormalTok{  \} }\ControlFlowTok{else} \FunctionTok{return}\NormalTok{(}\FunctionTok{substr}\NormalTok{(group, }\DecValTok{1}\NormalTok{, }\FunctionTok{nchar}\NormalTok{(group) }\SpecialCharTok{{-}} \DecValTok{2}\NormalTok{))}
\NormalTok{\}}

\NormalTok{data }\OtherTok{\textless{}{-}}\NormalTok{ KDAc }\SpecialCharTok{\%\textgreater{}\%}

\NormalTok{    \{}\ControlFlowTok{if}\NormalTok{ (new\_used }\SpecialCharTok{!=} \StringTok{"BOTH"}\NormalTok{)}
        
\NormalTok{        dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(., nu }\SpecialCharTok{==}\NormalTok{ new\_used) }\CommentTok{\# this and last month}
      \ControlFlowTok{else}\NormalTok{ .}
\NormalTok{        \} }\SpecialCharTok{\%\textgreater{}\%}
    
\NormalTok{    \{}\ControlFlowTok{if}\NormalTok{ (purchase\_lease }\SpecialCharTok{!=} \StringTok{"BOTH"}\NormalTok{)}
        
\NormalTok{        dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(., pl }\SpecialCharTok{==}\NormalTok{ purchase\_lease)}
      \ControlFlowTok{else}\NormalTok{ .}
\NormalTok{      \} }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{group\_by}\NormalTok{(}\SpecialCharTok{!!}\AttributeTok{group :=} \FunctionTok{floor\_date}\NormalTok{(date, }\FunctionTok{group\_unit}\NormalTok{(}\SpecialCharTok{!!}\NormalTok{group))) }\SpecialCharTok{\%\textgreater{}\%}
        
\NormalTok{  \{}\ControlFlowTok{if}\NormalTok{ (metric }\SpecialCharTok{==} \StringTok{"n"}\NormalTok{)}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(., }\AttributeTok{n =} \FunctionTok{n}\NormalTok{(), date)}
    \ControlFlowTok{else}
\NormalTok{      dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(., }\SpecialCharTok{!!}\AttributeTok{metric :=} \FunctionTok{mean}\NormalTok{(}\FunctionTok{get}\NormalTok{(metric), }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), date)\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'weekly'. You can override using the
## `.groups` argument.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
      \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{get}\NormalTok{(group), }\AttributeTok{y =} \FunctionTok{get}\NormalTok{(metric)), }\AttributeTok{color =}\NormalTok{ blue, }\AttributeTok{linewidth =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{get}\NormalTok{(group), }\AttributeTok{y =} \FunctionTok{get}\NormalTok{(metric)), }\AttributeTok{color =}\NormalTok{ blue, }\AttributeTok{size =} \FloatTok{1.5}\NormalTok{) }\SpecialCharTok{+}
      \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{get}\NormalTok{(group), }\AttributeTok{y =} \FunctionTok{get}\NormalTok{(metric)), }\AttributeTok{color =}\NormalTok{ lightblue, }\AttributeTok{linewidth =}\NormalTok{ .}\DecValTok{5}\NormalTok{) }\SpecialCharTok{+}



  
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{,}
       \AttributeTok{y =} \FunctionTok{paste0}\NormalTok{(metric))}
\end{Highlighting}
\end{Shaded}

\includegraphics{ReportOut_files/figure-latex/unnamed-chunk-1-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\#\# rolling average}
\CommentTok{\#https://stackoverflow.com/questions/33769770/use{-}rollapply{-}and{-}zoo{-}to{-}calculate{-}rolling{-}average{-}of{-}a{-}column{-}of{-}variables}

\CommentTok{\# Change in sales for the 5 most common vehicles new/used}

\CommentTok{\# don\textquotesingle{}t really care about latency, we can dynamically create plots based on parameters}

\NormalTok{new\_used }\OtherTok{\textless{}{-}} \StringTok{"BOTH"}
\NormalTok{movers\_n }\OtherTok{\textless{}{-}} \DecValTok{10}

\CommentTok{\# biggest movers from last month ??}

\NormalTok{movers }\OtherTok{\textless{}{-}}\NormalTok{ KDAc }\SpecialCharTok{\%\textgreater{}\%}
  
\NormalTok{  \{}\ControlFlowTok{if}\NormalTok{ (new\_used }\SpecialCharTok{!=} \StringTok{"BOTH"}\NormalTok{)}
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(., nu }\SpecialCharTok{==}\NormalTok{ new\_used, date }\SpecialCharTok{\textgreater{}=}\NormalTok{ nmonth, date }\SpecialCharTok{\textless{}=}\NormalTok{ pqmonth) }\CommentTok{\# this and last month}
    \ControlFlowTok{else} 
\NormalTok{      dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(., date }\SpecialCharTok{\textgreater{}=}\NormalTok{ nmonth, date }\SpecialCharTok{\textless{}=}\NormalTok{ pqmonth)}
\NormalTok{  \} }\SpecialCharTok{\%\textgreater{}\%}
  
\NormalTok{  \{}\ControlFlowTok{if}\NormalTok{ (new\_used }\SpecialCharTok{==} \StringTok{"USED"}\NormalTok{) }
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(., }\AttributeTok{carname =} \FunctionTok{str\_c}\NormalTok{(make, }\StringTok{" "}\NormalTok{, model), }\AttributeTok{.keep =} \StringTok{\textquotesingle{}unused\textquotesingle{}}\NormalTok{)}
    \ControlFlowTok{else} \CommentTok{\# Only by model, not by year}
\NormalTok{      dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(., }\AttributeTok{carname =} \FunctionTok{str\_c}\NormalTok{(make, }\StringTok{" "}\NormalTok{, model, }\StringTok{" "}\NormalTok{, caryear), }\AttributeTok{.keep =} \StringTok{\textquotesingle{}unused\textquotesingle{}}\NormalTok{)\} }\SpecialCharTok{\%\textgreater{}\%}
  
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(carname, }\AttributeTok{month =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{month}\NormalTok{(date) }\SpecialCharTok{==} \FunctionTok{month}\NormalTok{(pqmonth), }\StringTok{"current"}\NormalTok{, }\StringTok{"last"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# change month names}
  
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{id\_cols =} \StringTok{"carname"}\NormalTok{, }\AttributeTok{names\_from =} \StringTok{"month"}\NormalTok{, }\AttributeTok{values\_from =} \StringTok{"n"}\NormalTok{, }\AttributeTok{values\_fill =} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{change =}\NormalTok{ current }\SpecialCharTok{{-}}\NormalTok{ last) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice\_max}\NormalTok{(}\AttributeTok{n =}\NormalTok{ movers\_n, }\AttributeTok{order\_by =} \FunctionTok{abs}\NormalTok{(change), }\AttributeTok{with\_ties =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'carname'. You can override using the
## `.groups` argument.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{movers }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  
  \FunctionTok{geom\_segment}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(carname, change), }\AttributeTok{y =}\NormalTok{ last, }\AttributeTok{xend =}\NormalTok{ carname, }\AttributeTok{yend =}\NormalTok{ current, }\AttributeTok{color =}\NormalTok{ change }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{),}
               \AttributeTok{size =} \DecValTok{10}\NormalTok{, }\AttributeTok{lineend =} \StringTok{"round"}\NormalTok{) }\SpecialCharTok{+}
  
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ carname, }\AttributeTok{y =}\NormalTok{ current), }\AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{alpha =} \FloatTok{0.2}\NormalTok{, }\AttributeTok{size  =} \DecValTok{10}\NormalTok{) }\SpecialCharTok{+}

  
  \FunctionTok{geom\_segment}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(carname, change), }\AttributeTok{y =}\NormalTok{ current, }\AttributeTok{xend =}\NormalTok{ carname, }\AttributeTok{yend =}\NormalTok{ last),}
               \AttributeTok{color =} \StringTok{"white"}\NormalTok{,}
               \AttributeTok{size =} \FloatTok{1.1}\NormalTok{, }\AttributeTok{lineend =} \StringTok{"round"}\NormalTok{, }\AttributeTok{linejoin =} \StringTok{"bevel"}\NormalTok{,}
               \AttributeTok{arrow =} \FunctionTok{arrow}\NormalTok{(}\AttributeTok{length =} \FunctionTok{unit}\NormalTok{(}\FloatTok{0.15}\NormalTok{, }\StringTok{"in"}\NormalTok{), }\AttributeTok{ends =} \StringTok{"first"}\NormalTok{)) }\SpecialCharTok{+}
  
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{10}\NormalTok{),}
        \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{) }\SpecialCharTok{+}
  
  \FunctionTok{scale\_color\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(red, green)) }\SpecialCharTok{+}
  
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Biggest Movers This Month ("}\NormalTok{, new\_used, }\StringTok{")"}\NormalTok{),}
       \AttributeTok{subtitle =}\NormalTok{ repfor,}
       \AttributeTok{x =} \StringTok{""}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Change In Sales"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## i Please use `linewidth` instead.
\end{verbatim}

\includegraphics{ReportOut_files/figure-latex/new.used movers-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# n.months must be less than as.numeric(month(pmonth, abbr = FALSE, label = FALSE))}
\NormalTok{n.months }\OtherTok{\textless{}{-}} \DecValTok{6}

\NormalTok{metric }\OtherTok{\textless{}{-}} \StringTok{"n"}

\NormalTok{metric\_dict }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\AttributeTok{n =} \StringTok{"Total Sales"}\NormalTok{, }
                 \AttributeTok{front\_gross\_profit =} \StringTok{"Avg. Front Gross Profit"}\NormalTok{, }
                 \AttributeTok{back\_gross\_profit =} \StringTok{"Avg. Back Gross Profit"}\NormalTok{,}
                 \AttributeTok{total\_gross\_profit =} \StringTok{"Avg. Total Gross Profit"}\NormalTok{,}
                 \AttributeTok{cash\_price =} \StringTok{"Avg. Cash Price"}\NormalTok{)}

\NormalTok{mlabs }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \FunctionTok{paste0}\NormalTok{(}\FunctionTok{month}\NormalTok{(}
\NormalTok{    pmonth }\SpecialCharTok{{-}} \FunctionTok{months}\NormalTok{(}\FunctionTok{as.numeric}\NormalTok{(x)),}
    \AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{,}
    \AttributeTok{abbr =} \ConstantTok{FALSE}
\NormalTok{  ))}
\NormalTok{\}}

\NormalTok{mgroups }\OtherTok{\textless{}{-}}\NormalTok{ KDAc }\SpecialCharTok{\%\textgreater{}\%}
  
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{mgroup =} \FunctionTok{factor}\NormalTok{(}\FunctionTok{month}\NormalTok{(pmonth) }\SpecialCharTok{{-}} \FunctionTok{month}\NormalTok{(date), }\AttributeTok{ordered =} \ConstantTok{TRUE}\NormalTok{),}
                \AttributeTok{theyear =} \FunctionTok{year}\NormalTok{(date)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{group\_by}\NormalTok{(mgroup, theyear) }\SpecialCharTok{\%\textgreater{}\%}
  
\NormalTok{  \{}\ControlFlowTok{if}\NormalTok{ (metric }\SpecialCharTok{==} \StringTok{"n"}\NormalTok{)}
    \FunctionTok{summarise}\NormalTok{(., }\AttributeTok{y =} \FunctionTok{n}\NormalTok{(), mgroup, theyear)}
    \ControlFlowTok{else}
      \FunctionTok{summarise}\NormalTok{(., }\AttributeTok{y =} \FunctionTok{mean}\NormalTok{(}\FunctionTok{get}\NormalTok{(metric), }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), mgroup, theyear)\} }\SpecialCharTok{\%\textgreater{}\%}

  \FunctionTok{distinct}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(theyear }\SpecialCharTok{\textgreater{}=} \FunctionTok{year}\NormalTok{(pmonth) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, mgroup }\SpecialCharTok{\textless{}=}\NormalTok{ n.months }\SpecialCharTok{{-}} \DecValTok{1} \SpecialCharTok{\&\&}
\NormalTok{                mgroup }\SpecialCharTok{\textgreater{}=} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'mgroup', 'theyear'. You can override using
## the `.groups` argument.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ mgroups }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(theyear }\SpecialCharTok{==} \FunctionTok{year}\NormalTok{(pmonth)),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mgroup, }\AttributeTok{y =}\NormalTok{ y),}
    \AttributeTok{width =} \FloatTok{0.7}\NormalTok{,}
    \AttributeTok{stat =} \StringTok{"identity"}\NormalTok{,}
    \AttributeTok{fill =}\NormalTok{ lightblue,}
    \AttributeTok{alpha =} \FloatTok{0.8}
\NormalTok{  ) }\SpecialCharTok{+}
  
  \FunctionTok{geom\_line}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ mgroups }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(theyear }\SpecialCharTok{==} \FunctionTok{year}\NormalTok{(pmonth) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mgroup, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{group =}\NormalTok{ theyear),}
    \AttributeTok{lwd =} \FloatTok{1.5}\NormalTok{,}
    \AttributeTok{lty =} \DecValTok{9}\NormalTok{,}
    \AttributeTok{alpha =} \FloatTok{0.6}
\NormalTok{  ) }\SpecialCharTok{+}
  
  \FunctionTok{geom\_label}\NormalTok{(}
    \AttributeTok{data =}\NormalTok{ mgroups }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(theyear }\SpecialCharTok{==} \FunctionTok{year}\NormalTok{(pmonth) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, mgroup }\SpecialCharTok{==}\NormalTok{ n.months }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{),}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mgroup, }\AttributeTok{y =}\NormalTok{ y }\SpecialCharTok{{-}} \DecValTok{10}\NormalTok{, }\AttributeTok{label =} \StringTok{"Last Year"}\NormalTok{),}
    \AttributeTok{fill =} \StringTok{"black"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"white"}
\NormalTok{  ) }\SpecialCharTok{+}
  
\NormalTok{  \{}\ControlFlowTok{if}\NormalTok{ (metric }\SpecialCharTok{==} \StringTok{"n"}\NormalTok{) }
      \FunctionTok{geom\_label}\NormalTok{(}\AttributeTok{data =}\NormalTok{ mgroups }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(theyear }\SpecialCharTok{==} \FunctionTok{year}\NormalTok{(pmonth)),}
             \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mgroup, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{label =} \FunctionTok{comma}\NormalTok{(}\FunctionTok{round}\NormalTok{(y))))}
    \ControlFlowTok{else}
      \FunctionTok{geom\_label}\NormalTok{(}\AttributeTok{data =}\NormalTok{ mgroups }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(theyear }\SpecialCharTok{==} \FunctionTok{year}\NormalTok{(pmonth)),}
                 \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mgroup, }\AttributeTok{y =}\NormalTok{ y, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"$"}\NormalTok{, }\FunctionTok{comma}\NormalTok{(}\FunctionTok{round}\NormalTok{(y)))))}
\NormalTok{    \} }\SpecialCharTok{+}
  
  \FunctionTok{scale\_x\_discrete}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ mlabs, }\AttributeTok{limits =}\NormalTok{ rev) }\SpecialCharTok{+}
  
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+}
  
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(metric\_dict[metric], }\StringTok{" in the Last "}\NormalTok{, n.months, }\StringTok{" Months"}\NormalTok{),}
    \AttributeTok{subtitle =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"From "}\NormalTok{, repfor),}
    \AttributeTok{y =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,}
    \AttributeTok{x =} \StringTok{\textquotesingle{}\textquotesingle{}}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{ReportOut_files/figure-latex/Last 6 Months Sales-1.pdf}

Compare this month to other years

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calmonth }\OtherTok{\textless{}{-}}\NormalTok{ KDAc }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{month}\NormalTok{(date) }\SpecialCharTok{==} \FunctionTok{month}\NormalTok{(pmonth), }\FunctionTok{year}\NormalTok{(date) }\SpecialCharTok{\textless{}=} \FunctionTok{year}\NormalTok{(pmonth)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(}\AttributeTok{theyear =} \FunctionTok{year}\NormalTok{(date)) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{transmute}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Avg. Cash Price}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{mean}\NormalTok{(cash\_price, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                   \StringTok{\textasciigrave{}}\AttributeTok{Total Gross}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(total\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                   \StringTok{\textasciigrave{}}\AttributeTok{Back Gross}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(back\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                   \StringTok{\textasciigrave{}}\AttributeTok{Front Gross}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(front\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
                   \StringTok{\textasciigrave{}}\AttributeTok{New Sales}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(}\FunctionTok{ifelse}\NormalTok{(nu }\SpecialCharTok{==} \StringTok{"NEW"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
                   \StringTok{\textasciigrave{}}\AttributeTok{Used Sales}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(}\FunctionTok{ifelse}\NormalTok{(nu }\SpecialCharTok{==} \StringTok{"USED"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
\NormalTok{                   ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{distinct}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{pivot\_longer}\NormalTok{(}\SpecialCharTok{!}\NormalTok{theyear, }\AttributeTok{names\_to =} \StringTok{"name"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"value"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(}\AttributeTok{name =} \FunctionTok{factor}\NormalTok{(name, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Total Gross"}\NormalTok{, }\CommentTok{\# ordered}
                                          \StringTok{"Back Gross"}\NormalTok{,}
                                          \StringTok{"Front Gross"}\NormalTok{,}
                                          \StringTok{"Avg. Cash Price"}\NormalTok{,}
                                          \StringTok{"New Sales"}\NormalTok{,}
                                          \StringTok{"Used Sales"}\NormalTok{), }\AttributeTok{ordered =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ranks =} \FunctionTok{order}\NormalTok{(}\FunctionTok{order}\NormalTok{(value, }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)), }\CommentTok{\# actual ranks}
         \AttributeTok{rankval =} \FunctionTok{rank}\NormalTok{(value)) }\CommentTok{\# numeric bar chart value}

\FunctionTok{ggplot}\NormalTok{(calmonth) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ theyear, }\AttributeTok{y =}\NormalTok{ rankval, }\AttributeTok{fill =}\NormalTok{ rankval),  }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{) }\SpecialCharTok{+} 
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{name) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ theyear, }\AttributeTok{y =}\NormalTok{ rankval}\SpecialCharTok{/}\DecValTok{2}\NormalTok{, }\AttributeTok{label =}\NormalTok{ ranks), }\AttributeTok{color =}\NormalTok{ white) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_gradient2}\NormalTok{(}\AttributeTok{midpoint =} \DecValTok{3}\NormalTok{, }\AttributeTok{low =}\NormalTok{ red, }\AttributeTok{mid =}\NormalTok{ llightblue,}
                     \AttributeTok{high =}\NormalTok{ blue) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Ranking "}\NormalTok{, repfor),}
       \AttributeTok{subtitle =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"Compared to other \textquotesingle{}"}\NormalTok{, }\FunctionTok{month}\NormalTok{(pmonth, }\AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{abbr =} \ConstantTok{FALSE}\NormalTok{), }\StringTok{"\textquotesingle{}s"}\NormalTok{),}
       \AttributeTok{x =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{,}
       \AttributeTok{y =} \StringTok{\textquotesingle{}\textquotesingle{}}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{,}
        \AttributeTok{axis.text.y =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.ticks.y =} \FunctionTok{element\_blank}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\includegraphics{ReportOut_files/figure-latex/This Month\textquotesingle{}s Rank Among Other Years-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# best salesman by avg cash price? avg fgp? n sales? for this month}

\NormalTok{salesman\_metric }\OtherTok{\textless{}{-}} \StringTok{"n"} \CommentTok{\# button!}

\NormalTok{salesman.n }\OtherTok{\textless{}{-}} \DecValTok{5}

\NormalTok{salesman\_metric\_dict }\OtherTok{\textless{}{-}}
  \FunctionTok{c}\NormalTok{(}\AttributeTok{n =} \StringTok{"Total Sales"}\NormalTok{, }\AttributeTok{fgp\_a =} \StringTok{"Avg. Front Gross Profit"}\NormalTok{, }\AttributeTok{cp\_a =} \StringTok{"Avg. Cash Price"}\NormalTok{)}

\NormalTok{salespeople }\OtherTok{\textless{}{-}}\NormalTok{ KDAc }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(date }\SpecialCharTok{\textgreater{}=}\NormalTok{ pmonth, date }\SpecialCharTok{\textless{}=}\NormalTok{ pqmonth) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(salesman) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{transmute}\NormalTok{(}
    \AttributeTok{cp\_a =} \FunctionTok{mean}\NormalTok{(cash\_price, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{fgp\_a =} \FunctionTok{mean}\NormalTok{(front\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
\NormalTok{    salesman}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{distinct}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice\_max}\NormalTok{(}\AttributeTok{n =}\NormalTok{ salesman.n, }\AttributeTok{order\_by =} \FunctionTok{get}\NormalTok{(salesman\_metric))}

\NormalTok{salespeople }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(salesman, }\FunctionTok{get}\NormalTok{(salesman\_metric)),}
                          \AttributeTok{y =} \FunctionTok{get}\NormalTok{(salesman\_metric)),}
                      \AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{fill =}\NormalTok{ lightblue) }\SpecialCharTok{+}
\NormalTok{  \{}
    \ControlFlowTok{if}\NormalTok{ (salesman\_metric }\SpecialCharTok{==} \StringTok{"n"}\NormalTok{)}
      \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}
        \AttributeTok{x =}\NormalTok{ salesman,}
        \AttributeTok{y =} \FunctionTok{get}\NormalTok{(salesman\_metric),}
        \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(salesman, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, }\FunctionTok{round}\NormalTok{(}\FunctionTok{get}\NormalTok{(salesman\_metric), }\AttributeTok{digits =} \DecValTok{0}\NormalTok{))}
\NormalTok{      ),}
      \AttributeTok{size =} \DecValTok{3}\NormalTok{)}
\NormalTok{  \} }\SpecialCharTok{+}
\NormalTok{  \{}
    \ControlFlowTok{if}\NormalTok{ (salesman\_metric }\SpecialCharTok{!=} \StringTok{"n"}\NormalTok{)}
      \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}
        \AttributeTok{x =}\NormalTok{ salesman,}
        \AttributeTok{y =} \FunctionTok{get}\NormalTok{(salesman\_metric),}
        \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(salesman, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{$"}\NormalTok{, scales}\SpecialCharTok{::}\FunctionTok{comma}\NormalTok{(}\FunctionTok{round}\NormalTok{(}
          \FunctionTok{get}\NormalTok{(salesman\_metric), }\AttributeTok{digits =} \DecValTok{0}
\NormalTok{        )))}
\NormalTok{      ),}
      \AttributeTok{size =} \DecValTok{3}\NormalTok{)}
\NormalTok{  \} }\SpecialCharTok{+}
  \CommentTok{\# geom\_label(aes(x = salesman,}
  \CommentTok{\#                y = get(salesman\_metric),}
  \CommentTok{\#                label = paste0(salesman, "\textbackslash{}n", scales::comma(round(get(salesman\_metric), digits = 0)))),}
  \CommentTok{\#            size = 3) +}
  
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Top Salesman By"}\NormalTok{, salesman\_metric\_dict[salesman\_metric]),}
    \AttributeTok{subtitle =}\NormalTok{ repfor,}
    \AttributeTok{y =}\NormalTok{ salesman\_metric\_dict[salesman\_metric],}
    \AttributeTok{x =} \StringTok{""}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{expansion}\NormalTok{(}\AttributeTok{mult =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.05}\NormalTok{)),}
                     \AttributeTok{breaks =} \FunctionTok{integer\_breaks}\NormalTok{()) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.ticks.x =} \FunctionTok{element\_blank}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\includegraphics{ReportOut_files/figure-latex/People-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# best fi manager by back gross?}

\NormalTok{fi.n }\OtherTok{\textless{}{-}} \DecValTok{5}

\NormalTok{fipeople }\OtherTok{\textless{}{-}}\NormalTok{ KDAc }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(date }\SpecialCharTok{\textgreater{}=}\NormalTok{ pmonth, date }\SpecialCharTok{\textless{}=}\NormalTok{ pqmonth) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(fimanager) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{transmute}\NormalTok{(}\AttributeTok{bgp\_a =} \FunctionTok{mean}\NormalTok{(back\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{), fimanager) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{distinct}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice\_max}\NormalTok{(}\AttributeTok{n =}\NormalTok{ fi.n, }\AttributeTok{order\_by =}\NormalTok{ bgp\_a)}

\NormalTok{fipeople }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(fimanager, bgp\_a),}
                          \AttributeTok{y =}\NormalTok{ bgp\_a),}
                      \AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{fill =}\NormalTok{ lightblue) }\SpecialCharTok{+}
  \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}
    \AttributeTok{x =}\NormalTok{ fimanager,}
    \AttributeTok{y =}\NormalTok{ bgp\_a,}
    \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(fimanager, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{ $"}\NormalTok{, scales}\SpecialCharTok{::}\FunctionTok{comma}\NormalTok{(}\FunctionTok{round}\NormalTok{(bgp\_a, }\AttributeTok{digits =} \DecValTok{0}\NormalTok{)))}
\NormalTok{  ),}
  \AttributeTok{size =} \DecValTok{3}\NormalTok{) }\SpecialCharTok{+}
  
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{title =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Top Finance Manager By Avg. Back Gross Profit"}\NormalTok{),}
    \AttributeTok{subtitle =}\NormalTok{ repfor,}
    \AttributeTok{y =} \StringTok{"Back Gross Profit"}\NormalTok{,}
    \AttributeTok{x =} \StringTok{""}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{expand =} \FunctionTok{expansion}\NormalTok{(}\AttributeTok{mult =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.05}\NormalTok{)),}
                     \AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_blank}\NormalTok{(),}
        \AttributeTok{axis.ticks.x =} \FunctionTok{element\_blank}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\includegraphics{ReportOut_files/figure-latex/People-2.pdf}

\hypertarget{next-month}{%
\section{Next Month?}\label{next-month}}

Based on past business performance cycles, months + years

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# years on right, months on left?}
\CommentTok{\#}
\NormalTok{nmonth\_metric }\OtherTok{\textless{}{-}} \StringTok{"Back Gross"}

\NormalTok{estimates\_for }\OtherTok{\textless{}{-}} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{month}\NormalTok{(nmonth, }\AttributeTok{abbr =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{), }\StringTok{", "}\NormalTok{, }\FunctionTok{year}\NormalTok{(nmonth))}

\CommentTok{\# last 2 months, last 2 years}
\NormalTok{predate }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(}\FunctionTok{rev}\NormalTok{(}\FunctionTok{month}\NormalTok{((nmonth) }\SpecialCharTok{{-}} \FunctionTok{months}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{2}\NormalTok{), }\AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{abbr =} \ConstantTok{FALSE}\NormalTok{))), }\CommentTok{\# last 2 months}
\NormalTok{                          estimates\_for,}
\NormalTok{                          (}\FunctionTok{year}\NormalTok{(nmonth) }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)}\SpecialCharTok{:}\FunctionTok{year}\NormalTok{((nmonth) }\SpecialCharTok{{-}} \FunctionTok{years}\NormalTok{(}\DecValTok{2}\NormalTok{)))) }\CommentTok{\# last 2 years}

\CommentTok{\# group 2 insert for next month}
\NormalTok{thismonthinsert }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{group =} \DecValTok{2}\NormalTok{, }
                        \AttributeTok{tframe =}\NormalTok{ estimates\_for, }
                        \StringTok{"Avg. Cash Price"} \OtherTok{=} \ConstantTok{NULL}\NormalTok{,}
                        \StringTok{"Total Gross"} \OtherTok{=} \ConstantTok{NULL}\NormalTok{, }
                        \StringTok{"Back Gross"} \OtherTok{=} \ConstantTok{NULL}\NormalTok{,}
                        \StringTok{"Front Gross"} \OtherTok{=} \ConstantTok{NULL}\NormalTok{, }
                        \StringTok{"New Sales"} \OtherTok{=} \ConstantTok{NULL}\NormalTok{,}
                        \StringTok{"Used Sales"} \OtherTok{=} \ConstantTok{NULL}\NormalTok{)}

\CommentTok{\# previous months + years for next month}

\NormalTok{nmonth\_df }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(KDAc }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# last 2 months}
\NormalTok{                   dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(date }\SpecialCharTok{\textgreater{}=}\NormalTok{ pmonth }\SpecialCharTok{{-}} \FunctionTok{months}\NormalTok{(}\DecValTok{1}\NormalTok{), date }\SpecialCharTok{\textless{}}\NormalTok{ pqmonth) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{                   dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{group =} \DecValTok{1}\NormalTok{, }\AttributeTok{tframe =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{month}\NormalTok{(date, }\AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{abbr =} \ConstantTok{FALSE}\NormalTok{))),}
\NormalTok{                 KDAc }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# last 2 years}
\NormalTok{                   dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(}\FunctionTok{month}\NormalTok{(date) }\SpecialCharTok{==} \FunctionTok{month}\NormalTok{(pmonth) }\SpecialCharTok{+} \DecValTok{1}\NormalTok{, }\FunctionTok{year}\NormalTok{(date) }\SpecialCharTok{\textgreater{}=} \FunctionTok{year}\NormalTok{(pmonth) }\SpecialCharTok{{-}} \DecValTok{2}\NormalTok{, date }\SpecialCharTok{\textless{}}\NormalTok{ pqmonth) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{                   dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{group =} \DecValTok{3}\NormalTok{, }\AttributeTok{tframe =} \FunctionTok{as.character}\NormalTok{(}\FunctionTok{year}\NormalTok{(date)))) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(group, tframe) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Avg. Cash Price}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{mean}\NormalTok{(cash\_price, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
            \StringTok{\textasciigrave{}}\AttributeTok{Total Gross}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(total\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
            \StringTok{\textasciigrave{}}\AttributeTok{Back Gross}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(back\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
            \StringTok{\textasciigrave{}}\AttributeTok{Front Gross}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(front\_gross\_profit, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
            \StringTok{\textasciigrave{}}\AttributeTok{New Sales}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(}\FunctionTok{ifelse}\NormalTok{(nu }\SpecialCharTok{==} \StringTok{"NEW"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)),}
            \StringTok{\textasciigrave{}}\AttributeTok{Used Sales}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{sum}\NormalTok{(}\FunctionTok{ifelse}\NormalTok{(nu }\SpecialCharTok{==} \StringTok{"USED"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{bind\_rows}\NormalTok{(thismonthinsert) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{tframe =} \FunctionTok{factor}\NormalTok{(tframe, }\AttributeTok{levels =}\NormalTok{ predate, }\AttributeTok{order =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \SpecialCharTok{{-}}\FunctionTok{any\_of}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"group"}\NormalTok{, }\StringTok{"tframe"}\NormalTok{)), }\AttributeTok{names\_to =} \StringTok{"class"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"value"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(group, class) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{a =} \FunctionTok{ifelse}\NormalTok{(group }\SpecialCharTok{!=} \DecValTok{2}\NormalTok{, }\FunctionTok{coef}\NormalTok{(}\FunctionTok{lm}\NormalTok{(value }\SpecialCharTok{\textasciitilde{}} \FunctionTok{as.numeric}\NormalTok{(tframe)))[}\DecValTok{2}\NormalTok{], }\DecValTok{0}\NormalTok{),}
                \AttributeTok{b =} \FunctionTok{ifelse}\NormalTok{(group }\SpecialCharTok{!=} \DecValTok{2}\NormalTok{, }\FunctionTok{coef}\NormalTok{(}\FunctionTok{lm}\NormalTok{(value }\SpecialCharTok{\textasciitilde{}} \FunctionTok{as.numeric}\NormalTok{(tframe)))[}\DecValTok{1}\NormalTok{], }\DecValTok{0}\NormalTok{))}

\ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\NormalTok{(nmonth\_metric }\SpecialCharTok{\%in\%}\NormalTok{ nmonth\_df}\SpecialCharTok{$}\NormalTok{class)) \{}
  \FunctionTok{warning}\NormalTok{(}\StringTok{"Enter a valid class"}\NormalTok{)}
\NormalTok{\} }

\CommentTok{\# prediction function}
\NormalTok{predrectf }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(facet) \{}
\NormalTok{  g1 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(}\FunctionTok{lm}\NormalTok{(value }\SpecialCharTok{\textasciitilde{}} \FunctionTok{as.numeric}\NormalTok{(tframe), }\AttributeTok{data =}\NormalTok{ nmonth\_df, }\AttributeTok{subset =}\NormalTok{ (group }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ class }\SpecialCharTok{==}\NormalTok{ nmonth\_metric)), }\FunctionTok{list}\NormalTok{(}\AttributeTok{tframe =} \DecValTok{3}\NormalTok{))}
\NormalTok{  g3 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(}\FunctionTok{lm}\NormalTok{(value }\SpecialCharTok{\textasciitilde{}} \FunctionTok{as.numeric}\NormalTok{(tframe), }\AttributeTok{data =}\NormalTok{ nmonth\_df, }\AttributeTok{subset =}\NormalTok{ (group }\SpecialCharTok{==} \DecValTok{3} \SpecialCharTok{\&}\NormalTok{ class }\SpecialCharTok{==}\NormalTok{ nmonth\_metric)), }\FunctionTok{list}\NormalTok{(}\AttributeTok{tframe =} \DecValTok{3}\NormalTok{))}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\AttributeTok{group1 =}\NormalTok{ g1, }\AttributeTok{group3 =}\NormalTok{ g3))}
\NormalTok{\}}

\CommentTok{\# get bounding box}
\NormalTok{predrect }\OtherTok{\textless{}{-}} \FunctionTok{predrectf}\NormalTok{()}

\NormalTok{nmonth\_df }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(class }\SpecialCharTok{==}\NormalTok{ nmonth\_metric) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ tframe, }\AttributeTok{y =}\NormalTok{ value, }\AttributeTok{fill =} \FunctionTok{factor}\NormalTok{(group), }\AttributeTok{shape =} \FunctionTok{factor}\NormalTok{(group)),}
             \AttributeTok{size =} \DecValTok{5}\NormalTok{,}
             \AttributeTok{color =} \StringTok{"black"}\NormalTok{,}
             \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_shape\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\DecValTok{25}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{22}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{slope =}\NormalTok{ a, }\AttributeTok{intercept =}\NormalTok{ b, }\AttributeTok{color =} \FunctionTok{factor}\NormalTok{(group)),}
             \AttributeTok{lty =} \DecValTok{2}\NormalTok{, }\AttributeTok{size =} \DecValTok{2}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{15}\NormalTok{),}
        \AttributeTok{legend.position =} \StringTok{"none"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_rect}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =} \FloatTok{2.8}\NormalTok{, }\AttributeTok{xmax =} \FloatTok{3.2}\NormalTok{, }\AttributeTok{ymin =} \FunctionTok{min}\NormalTok{(predrect), }\AttributeTok{ymax =} \FunctionTok{max}\NormalTok{(predrect)),  }\CommentTok{\# should always be between 5.5 and 6.5}
            \AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }
            \AttributeTok{data =}\NormalTok{ nmonth\_df }\SpecialCharTok{\%\textgreater{}\%}
             \FunctionTok{filter}\NormalTok{(group }\SpecialCharTok{==} \DecValTok{2}\NormalTok{), }
            \AttributeTok{inherit.aes =} \ConstantTok{FALSE}\NormalTok{, }
            \AttributeTok{alpha =} \FloatTok{0.1}\NormalTok{,}
            \AttributeTok{color =} \StringTok{"black"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ comma) }\SpecialCharTok{+} 
  \FunctionTok{coord\_cartesian}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\FunctionTok{min}\NormalTok{(predrect) }\SpecialCharTok{*} \FloatTok{0.7}\NormalTok{, }\FunctionTok{max}\NormalTok{(predrect) }\SpecialCharTok{*} \FloatTok{1.3}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \FunctionTok{paste0}\NormalTok{(nmonth\_metric, }\StringTok{" Estimate for This Month"}\NormalTok{),}
       \AttributeTok{subtitle =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{month}\NormalTok{(repon, }\AttributeTok{abbr =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{), }\StringTok{", "}\NormalTok{, }\FunctionTok{year}\NormalTok{(repon)),}
       \AttributeTok{x =} \StringTok{""}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Value"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{predictions}{%
\section{Predictions}\label{predictions}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# read in imaginary df(s)}
\end{Highlighting}
\end{Shaded}

\hypertarget{summary-statistics}{%
\subsubsection{2. Summary statistics}\label{summary-statistics}}

\hypertarget{we-have-some-nas-or-empty-spaces-in-the-data.-this-could-be-for-a}{%
\paragraph{We have some NA's, or empty spaces, in the data. This could
be for
a}\label{we-have-some-nas-or-empty-spaces-in-the-data.-this-could-be-for-a}}

\hypertarget{we-can-use-logistic-regression-to-tell-us-how-much-the-nas-might-influence}{%
\paragraph{We can use logistic regression to tell us how much the NAs
might
influence}\label{we-can-use-logistic-regression-to-tell-us-how-much-the-nas-might-influence}}

the data longitudinally. This is probably unnecessary but I'm going to
do it anyway.

\hypertarget{based-on-the-models-we-noticed-a-significant-trend-for-all-the-metrics.}{%
\paragraph{Based on the models, we noticed a significant trend for all
the
metrics.}\label{based-on-the-models-we-noticed-a-significant-trend-for-all-the-metrics.}}

It shouldn't impact analysis too much because we didn't test numeric
variables, but its something to keep in mind.

Generally, we saw more missing Front Gross Profit values and Cash Price
values at the end of the data set, and we saw more missing values for
Back Gross Profit and Total Gross Profit at the beginning of the data
set.

\hypertarget{plotting}{%
\subsubsection{3. Plotting}\label{plotting}}

\hypertarget{now-lets-look-at-some-quick-plots-of-the-data.}{%
\paragraph{Now, lets look at some quick plots of the
data.}\label{now-lets-look-at-some-quick-plots-of-the-data.}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ggplot(KDA1, aes(Date, Front\_Gross\_Profit)) + geom\_point() + geom\_smooth()}
\CommentTok{\# ggplot(KDA1, aes(Date, Back\_Gross\_Profit)) + geom\_point() + geom\_smooth()}
\CommentTok{\# ggplot(KDA1, aes(Date, Total\_Gross\_Profit)) + geom\_point() + geom\_smooth()}
\CommentTok{\# ggplot(KDA1, aes(Date, Cash\_Price)) + geom\_point() + geom\_smooth()}
\end{Highlighting}
\end{Shaded}

\hypertarget{section}{%
\paragraph{}\label{section}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ggplot(KDA1, aes(x = Date)) + geom\_smooth(aes(y = Front\_Gross\_Profit, col = "front"), se = F) +}
\CommentTok{\#   geom\_smooth(aes(y = Back\_Gross\_Profit, col = "back"), se = F) + ylab("") +}
\CommentTok{\#   geom\_smooth(aes(y = Total\_Gross\_Profit, col = "total"), se = F) +}
\CommentTok{\#   geom\_smooth(aes(y = .04*Cash\_Price, col = "cash"), se = F) }
\end{Highlighting}
\end{Shaded}

\hypertarget{if-we-hope-to-do-anything-with-this-we-will-have-to-extract-these-trends.}{%
\paragraph{If we hope to do anything with this, we will have to extract
these
trends.}\label{if-we-hope-to-do-anything-with-this-we-will-have-to-extract-these-trends.}}

To make this easier, lets create a new df for each day.

\hypertarget{condensing}{%
\subsubsection{4. Condensing}\label{condensing}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Day\textless{}{-} as.data.frame(seq(as.Date("2016{-}01{-}01"), as.Date("2020{-}11{-}16"), by="days"))}
\CommentTok{\# colnames(Day)\textless{}{-}c("Date")}
\CommentTok{\# temp\textless{}{-} group\_by(KDA1, Date) \%\textgreater{}\%}
\CommentTok{\#   mutate(sum.fgp = sum(Front\_Gross\_Profit, na.rm = TRUE)) \%\textgreater{}\%}
\CommentTok{\#   summarise(sum.fgp, .groups = \textquotesingle{}drop\textquotesingle{}) \%\textgreater{}\%}
\CommentTok{\#   unique()}
\CommentTok{\# Day\textless{}{-}left\_join(Day, count(group\_by(KDA1, Date)), by = "Date")}
\CommentTok{\# Day\textless{}{-}left\_join(Day, temp, by = "Date")}
\CommentTok{\# temp\textless{}{-} group\_by(KDA1, Date) \%\textgreater{}\%}
\CommentTok{\#   mutate(sum.bgp= sum(Back\_Gross\_Profit, na.rm = TRUE)) \%\textgreater{}\%}
\CommentTok{\#   summarise(sum.bgp, .groups = \textquotesingle{}drop\textquotesingle{}) \%\textgreater{}\%}
\CommentTok{\#   unique()}
\CommentTok{\# Day\textless{}{-}left\_join(Day, temp, by = "Date")}
\CommentTok{\# temp\textless{}{-} group\_by(KDA1, Date) \%\textgreater{}\%}
\CommentTok{\#   mutate(sum.tgp = sum(Total\_Gross\_Profit, na.rm = TRUE)) \%\textgreater{}\%}
\CommentTok{\#   summarise(sum.tgp, .groups = \textquotesingle{}drop\textquotesingle{}) \%\textgreater{}\%}
\CommentTok{\#   unique()}
\CommentTok{\# Day\textless{}{-}left\_join(Day, temp, by = "Date")}
\CommentTok{\# temp\textless{}{-} group\_by(KDA1, Date) \%\textgreater{}\%}
\CommentTok{\#   mutate(sum.cp = sum(Cash\_Price, na.rm = TRUE)) \%\textgreater{}\%}
\CommentTok{\#   summarise(sum.cp, .groups = \textquotesingle{}drop\textquotesingle{}) \%\textgreater{}\%}
\CommentTok{\#   unique()}
\CommentTok{\# Day\textless{}{-}left\_join(Day, temp, by = "Date")}
\end{Highlighting}
\end{Shaded}

\hypertarget{there-are-1782-days-with-55-nas-in-the-mix.-most-of-them-are-probably-within}{%
\paragraph{There are 1782 days, with 55 NAs in the mix. Most of them are
probably
within}\label{there-are-1782-days-with-55-nas-in-the-mix.-most-of-them-are-probably-within}}

that stretch in April of 2019. We will fix them by imputation. First
lets take a look at this new df, now with the number of sales per day
{[}n{]}. The missing values will automatically be predicted using a
simple linear model (loess).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# summary(Day)}
\CommentTok{\# Day \%\textgreater{}\%}
\CommentTok{\# ggplot(aes(x = Date)) + }
\CommentTok{\#   geom\_smooth(aes(y =.6*sum.tgp{-}600, color = "total gross"), }
\CommentTok{\#               se = F, method = \textquotesingle{}loess\textquotesingle{}) +}
\CommentTok{\#   geom\_smooth(aes(y = sum.bgp, color = "back gross"), }
\CommentTok{\#               se = F, method = \textquotesingle{}loess\textquotesingle{}) + }
\CommentTok{\#   geom\_smooth(aes(y = .6*sum.fgp + 8700, color = "front gross"), }
\CommentTok{\#               se = F, method = \textquotesingle{}loess\textquotesingle{}) +}
\CommentTok{\#   geom\_smooth(aes(y = .15*(sum.cp{-}183000), color = "cash price"), }
\CommentTok{\#               se = F, method = \textquotesingle{}loess\textquotesingle{}) +}
\CommentTok{\#   geom\_smooth(aes(y = 1000*n+5000, color = "n sales"), }
\CommentTok{\#               se = F, method = \textquotesingle{}loess\textquotesingle{}) + ylab("")}
\end{Highlighting}
\end{Shaded}

\hypertarget{imputation}{%
\subsubsection{5. Imputation}\label{imputation}}

\hypertarget{ive-chosen-to-impute-the-mssing-values-so-we-can-get-a-complete-df-that-we}{%
\paragraph{I've chosen to impute the mssing values so we can get a
complete df that
we}\label{ive-chosen-to-impute-the-mssing-values-so-we-can-get-a-complete-df-that-we}}

can run through functions and expect a complete output. To do this, we
can use a variety of methods. I've chosen to use predictive mean
matching, which uses a kind of regression that builds relationships
around the mean of each variable. Again, there are many ways to do this
and this might not be the best one. First, we train the algorithm 20
times {[}m = 20{]}, and we get its best guess at what the missing values
would be according to pmm. We can easily change the method later too.

\hypertarget{now-since-we-have-data-for-each-day-we-can-do-some-timeries-analysis-for}{%
\paragraph{Now, since we have data for each day, we can do some timeries
analysis
for}\label{now-since-we-have-data-for-each-day-we-can-do-some-timeries-analysis-for}}

all of our metrics. {[}freq = 365{]} because we have 365 observations
per year. Remember here, these values are taken from the sum of that
value every day. From, these plots, we really just need to pay attention
to the trend.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# b\textless{}{-}decompose(ts(Day.full$sum.bgp, frequency =365))}
\CommentTok{\# plot(b) + title("Back Gross", line = {-}.5)}
\CommentTok{\# f\textless{}{-}decompose(ts(Day.full$sum.fgp, frequency =365))}
\CommentTok{\# plot(f)+ title("Front Gross", line = {-}.5)}
\CommentTok{\# t\textless{}{-}decompose(ts(Day.full$sum.tgp, frequency =365))}
\CommentTok{\# plot(t) + title("Total Gross", line = {-}.5)}
\CommentTok{\# c\textless{}{-}decompose(ts(Day.full$sum.cp, frequency =365))}
\CommentTok{\# plot(c) + title("Cash Price", line = {-}.5)}
\CommentTok{\# n\textless{}{-}decompose(ts(Day.full$n, frequency =365))}
\CommentTok{\# plot(n) + title("N Sold", line =  {-}.5)}
\end{Highlighting}
\end{Shaded}

\hypertarget{looks-nice-and-informative.-now-lets-make-sure-all-our-data-is-in-the-standard}{%
\paragraph{Looks nice and informative. Now, lets make sure all our data
is in the
standard}\label{looks-nice-and-informative.-now-lets-make-sure-all-our-data-is-in-the-standard}}

style so we can easily compare it to other economic trends.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#dummy for joining}
\CommentTok{\# time.seq\textless{}{-}seq.Date(from = as.Date("2016{-}01{-}01"), to = as.Date("2020{-}11{-}16"), by = \textquotesingle{}day\textquotesingle{})}
\CommentTok{\# blank\textless{}{-}as.data.frame(time.seq)}
\CommentTok{\# colnames(blank)\textless{}{-}c("date")}
\CommentTok{\# \#\# Then the final df}
\CommentTok{\# rogue\textless{}{-} cbind(as.data.frame(Day.full$Date), as.data.frame(b$trend),}
\CommentTok{\#               as.data.frame(f$trend),}
\CommentTok{\#               as.data.frame(t$trend), as.data.frame(c$trend), }
\CommentTok{\#               as.data.frame(n$trend))}
\CommentTok{\# colnames(rogue)\textless{}{-}c("date", "backg", "frontg", "totalg", "cp", "n")}
\CommentTok{\# rogue\textless{}{-}left\_join(blank, rogue)}
\CommentTok{\# \#Finally, a very informative plot of our trends so far}
\CommentTok{\# plot(rogue)}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-sources}{%
\section{Data Sources}\label{data-sources}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(info\_df)) \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{\#\#["}\NormalTok{, info\_df}\SpecialCharTok{$}\NormalTok{name[i], }\StringTok{"]("}\NormalTok{, info\_df}\SpecialCharTok{$}\NormalTok{link[i], }\StringTok{")"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{\_"}\NormalTok{, info\_df}\SpecialCharTok{$}\NormalTok{key[i], }\StringTok{"\_"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{\_\_"}\NormalTok{, info\_df}\SpecialCharTok{$}\NormalTok{category[i], }\StringTok{"\_"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, info\_df}\SpecialCharTok{$}\NormalTok{updated[i], }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{, info\_df}\SpecialCharTok{$}\NormalTok{citation[i], }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\#\#\href{https://finance.yahoo.com/quote/GM}{General Motors Company
(GM)} \emph{GM} \_\_Consumer Cyclical, Auto Manufacturers\_ Dec 14, 2022
9:19 AM General Motors Company (GM), {[}GM{]}, retrieved from Alpha
Vantage Inc., Dec 14, 2022.

\#\#\href{https://finance.yahoo.com/quote/F}{Ford Motor Company (F)}
\emph{F} \_\_Consumer Cyclical, Auto Manufacturers\_ Dec 14, 2022 9:19
AM Ford Motor Company (F), {[}F{]}, retrieved from Alpha Vantage Inc.,
Dec 14, 2022.

\#\#\href{https://finance.yahoo.com/quote/TSLA}{Tesla, Inc.~(TSLA)}
\emph{TSLA} \_\_Consumer Cyclical, Auto Manufacturers\_ Dec 14, 2022
9:19 AM Tesla, Inc.~(TSLA), {[}TSLA{]}, retrieved from Alpha Vantage
Inc., Dec 14, 2022.

\#\#\href{https://finance.yahoo.com/quote/AN}{AutoNation, Inc.~(AN)}
\emph{AN} \_\_Consumer Cyclical, Auto \& Truck Dealerships\_ Dec 14,
2022 9:19 AM AutoNation, Inc.~(AN), {[}AN{]}, retrieved from Alpha
Vantage Inc., Dec 14, 2022.

\#\#\href{MZDAY}{Mazda Motor Corporation (MZDAY)} \emph{MZDAY} \_\_Mazda
Motor Corporation (MZDAY), {[}MZDAY{]}, retrieved from Alpha Vantage
Inc., Dec 14, 2022.\_ Dec 14, 2022 9:19 AM
\url{https://finance.yahoo.com/quote/MZDAY}

\#\#\href{https://finance.yahoo.com/quote/XOM}{Exxon Mobil Corporation
(XOM)} \emph{XOM} \_\_Energy, Oil \& Gas Integrated\_ Dec 14, 2022 9:19
AM Exxon Mobil Corporation (XOM), {[}XOM{]}, retrieved from Alpha
Vantage Inc., Dec 14, 2022.

\#\#\href{https://finance.yahoo.com/quote/TM}{Toyota Motor Corporation
(TM)} \emph{TM} \_\_Consumer Cyclical, Auto Manufacturers\_ Dec 14, 2022
9:19 AM Toyota Motor Corporation (TM), {[}TM{]}, retrieved from Alpha
Vantage Inc., Dec 14, 2022.

\#\#\href{LEA}{Lear Corporation (LEA)} \emph{LEA} \_\_Lear Corporation
(LEA), {[}LEA{]}, retrieved from Alpha Vantage Inc., Dec 14, 2022.\_ Dec
14, 2022 9:19 AM \url{https://finance.yahoo.com/quote/LEA}

\#\#\href{https://finance.yahoo.com/quote/BWA}{BorgWarner Inc.~(BWA)}
\emph{BWA} \_\_Consumer Cyclical, Auto Parts\_ Dec 14, 2022 9:19 AM
BorgWarner Inc.~(BWA), {[}BWA{]}, retrieved from Alpha Vantage Inc., Dec
14, 2022.

\#\#\href{VC}{Visteon Corporation (VC)} \emph{VC} \_\_Visteon
Corporation (VC), {[}VC{]}, retrieved from Alpha Vantage Inc., Dec 14,
2022.\_ Dec 14, 2022 9:20 AM \url{https://finance.yahoo.com/quote/VC}

\#\#\href{https://finance.yahoo.com/quote/GT}{The Goodyear Tire \&
Rubber Company (GT)} \emph{GT} \_\_Consumer Cyclical, Auto Parts\_ Dec
14, 2022 9:20 AM The Goodyear Tire \& Rubber Company (GT), {[}GT{]},
retrieved from Alpha Vantage Inc., Dec 14, 2022.

\#\#\href{https://finance.yahoo.com/quote/NIO}{NIO Inc.~(NIO)}
\emph{NIO} \_\_Consumer Cyclical, Auto Manufacturers\_ Dec 14, 2022 9:20
AM NIO Inc.~(NIO), {[}NIO{]}, retrieved from Alpha Vantage Inc., Dec 14,
2022.

\#\#\href{https://finance.yahoo.com/quote/HMC}{Honda Motor Co.,
Ltd.~(HMC)} \emph{HMC} \_\_Consumer Cyclical, Auto Manufacturers\_ Dec
14, 2022 9:20 AM Honda Motor Co., Ltd.~(HMC), {[}HMC{]}, retrieved from
Alpha Vantage Inc., Dec 14, 2022.

\#\#\href{https://finance.yahoo.com/quote/RACE}{Ferrari N.V. (RACE)}
\emph{RACE} \_\_Consumer Cyclical, Auto Manufacturers\_ Dec 14, 2022
9:20 AM Ferrari N.V. (RACE), {[}RACE{]}, retrieved from Alpha Vantage
Inc., Dec 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/UNRATE}{Unemployment Rate
(UNRATE)} \emph{unemp} \_\_Employment Situation\_ Dec 2, 2022 7:44 AM
CST U.S. Bureau of Labor Statistics, Unemployment Rate {[}UNRATE{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/UNRATE}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/UEMPLT5}{Number Unemployed
for Less Than 5 Weeks (UEMPLT5)} \emph{unempt5w} \_\_Employment
Situation\_ Dec 2, 2022 7:44 AM CST U.S. Bureau of Labor Statistics,
Number Unemployed for Less Than 5 Weeks {[}UEMPLT5{]}, retrieved from
FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/UEMPLT5}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/UEMP5TO14}{Number
Unemployed for 5-14 Weeks (UEMP5TO14)} \emph{unemp5tp14w} \_\_Employment
Situation\_ Dec 2, 2022 7:44 AM CST U.S. Bureau of Labor Statistics,
Number Unemployed for 5-14 Weeks {[}UEMP5TO14{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/UEMP5TO14}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/UEMP15T26}{Number
Unemployed for 15-26 Weeks (UEMP15T26)} \emph{unemp15to26w}
\_\_Employment Situation\_ Dec 2, 2022 7:44 AM CST U.S. Bureau of Labor
Statistics, Number Unemployed for 15-26 Weeks {[}UEMP15T26{]}, retrieved
from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/UEMP15T26}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/UEMP27OV}{Number Unemployed
for 27 Weeks \& over (UEMP27OV)} \emph{unemp27ov} \_\_Employment
Situation\_ Dec 2, 2022 7:44 AM CST U.S. Bureau of Labor Statistics,
Number Unemployed for 27 Weeks \& over {[}UEMP27OV{]}, retrieved from
FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/UEMP27OV}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/IR10000}{Import Price Index
(End Use): Crude Oil (IR10000)} \emph{oilimport} \_\_U.S. Import and
Export Price Indexes\_ Dec 14, 2022 7:36 AM CST U.S. Bureau of Labor
Statistics, Import Price Index (End Use): Crude Oil {[}IR10000{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/IR10000}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/MHHNGSP}{Henry Hub Natural
Gas Spot Price (MHHNGSP)} \emph{ngspot} \_\_Natural Gas Spot and Futures
Prices (NYMEX)\_ Dec 7, 2022 12:36 PM CST U.S. Energy Information
Administration, Henry Hub Natural Gas Spot Price {[}MHHNGSP{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/MHHNGSP}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/CUURA400SAH}{Consumer Price
Index for All Urban Consumers: Housing in West - Size Class A
(CUURA400SAH)} \emph{hcpi} \_\_Consumer Price Index\_ Dec 13, 2022 7:39
AM CST U.S. Bureau of Labor Statistics, Consumer Price Index for All
Urban Consumers: Housing in West - Size Class A {[}CUURA400SAH{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/CUURA400SAH}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/CUURA423SAF11}{Consumer
Price Index for All Urban Consumers: Food at Home in
Seattle-Tacoma-Bellevue WA (CBSA) (CUURA423SAF11)} \emph{food}
\_\_Consumer Price Index\_ Dec 13, 2022 7:38 AM CST U.S. Bureau of Labor
Statistics, Consumer Price Index for All Urban Consumers: Food at Home
in Seattle-Tacoma-Bellevue WA (CBSA) {[}CUURA423SAF11{]}, retrieved from
FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/CUURA423SAF11}, December 14,
2022.

\#\#\href{https://fred.stlouisfed.org/series/SAHMREALTIME}{Real-time
Sahm Rule Recession Indicator (SAHMREALTIME)} \emph{sahmrule} \_\_Sahm
Rule Recession Indicator\_ Dec 2, 2022 7:55 AM CST Sahm, Claudia,
Real-time Sahm Rule Recession Indicator {[}SAHMREALTIME{]}, retrieved
from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/SAHMREALTIME}, December 13,
2022.

\#\#\href{https://fred.stlouisfed.org/series/TB3MS}{3-Month Treasury
Bill Secondary Market Rate, Discount Basis (TB3MS)} \emph{discount}
\_\_H.15 Selected Interest Rates\_ Dec 1, 2022 3:18 PM CST Board of
Governors of the Federal Reserve System (US), 3-Month Treasury Bill
Secondary Market Rate, Discount Basis {[}TB3MS{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/TB3MS}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/CUURA423SEHA}{Consumer
Price Index for All Urban Consumers: Rent of Primary Residence in
Seattle-Tacoma-Bellevue WA (CBSA) (CUURA423SEHA)} \emph{localrent}
\_\_Consumer Price Index\_ Dec 13, 2022 7:38 AM CST U.S. Bureau of Labor
Statistics, Consumer Price Index for All Urban Consumers: Rent of
Primary Residence in Seattle-Tacoma-Bellevue WA (CBSA)
{[}CUURA423SEHA{]}, retrieved from FRED, Federal Reserve Bank of
St.~Louis; \url{https://fred.stlouisfed.org/series/CUURA423SEHA},
December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/DGORDER}{Manufacturers' New
Orders: Durable Goods (DGORDER)} \emph{durable} \_\_Manufacturer's
Shipments, Inventories, and Orders (M3) Survey\_ Dec 5, 2022 9:27 AM CST
U.S. Census Bureau, Manufacturers' New Orders: Durable Goods
{[}DGORDER{]}, retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/DGORDER}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/T10YIEM}{10-Year Breakeven
Inflation Rate (T10YIEM)} \emph{10yinf} \_\_Interest Rate Spreads\_ Dec
1, 2022 4:01 PM CST Federal Reserve Bank of St.~Louis, 10-Year Breakeven
Inflation Rate {[}T10YIEM{]}, retrieved from FRED, Federal Reserve Bank
of St.~Louis; \url{https://fred.stlouisfed.org/series/T10YIEM}, December
14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/APUS49D72610}{Average
Price: Electricity per Kilowatt-Hour in Seattle-Tacoma-Bellevue WA
(CBSA) (APUS49D72610)} \emph{kwhcost} \_\_Average Price Data\_ Dec 13,
2022 7:32 AM CST U.S. Bureau of Labor Statistics, Average Price:
Electricity per Kilowatt-Hour in Seattle-Tacoma-Bellevue WA (CBSA)
{[}APUS49D72610{]}, retrieved from FRED, Federal Reserve Bank of
St.~Louis; \url{https://fred.stlouisfed.org/series/APUS49D72610},
December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/UMCSENT}{University of
Michigan: Consumer Sentiment (UMCSENT)} \emph{sentiment} \_\_Surveys of
Consumers\_ Nov 23, 2022 10:01 AM CST University of Michigan, University
of Michigan: Consumer Sentiment {[}UMCSENT{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/UMCSENT}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/WABPPRIVSA}{New Private
Housing Units Authorized by Building Permits for Washington
(WABPPRIVSA)} \emph{new\_units} \_\_Housing Units Authorized By Building
Permits\_ Nov 23, 2022 8:41 AM CST U.S. Census Bureau, New Private
Housing Units Authorized by Building Permits for Washington
{[}WABPPRIVSA{]}, retrieved from FRED, Federal Reserve Bank of
St.~Louis; \url{https://fred.stlouisfed.org/series/WABPPRIVSA}, December
14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/ALTSALES}{Light Weight
Vehicle Sales: Autos and Light Trucks (ALTSALES)} \emph{altsales}
\_\_Supplemental Estimates, Motor Vehicles\_ Dec 5, 2022 11:09 AM CST
U.S. Bureau of Economic Analysis, Light Weight Vehicle Sales: Autos and
Light Trucks {[}ALTSALES{]}, retrieved from FRED, Federal Reserve Bank
of St.~Louis; \url{https://fred.stlouisfed.org/series/ALTSALES},
December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/TOTALSA}{Total Vehicle
Sales (TOTALSA)} \emph{totalsa} \_\_Supplemental Estimates, Motor
Vehicles\_ Dec 5, 2022 11:09 AM CST U.S. Bureau of Economic Analysis,
Total Vehicle Sales {[}TOTALSA{]}, retrieved from FRED, Federal Reserve
Bank of St.~Louis; \url{https://fred.stlouisfed.org/series/TOTALSA},
December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/LTRUCKSA}{Motor Vehicle
Retail Sales: Light Weight Trucks (LTRUCKSA)} \emph{ltrucksa}
\_\_Supplemental Estimates, Motor Vehicles\_ Dec 5, 2022 11:09 AM CST
U.S. Bureau of Economic Analysis, Motor Vehicle Retail Sales: Light
Weight Trucks {[}LTRUCKSA{]}, retrieved from FRED, Federal Reserve Bank
of St.~Louis; \url{https://fred.stlouisfed.org/series/LTRUCKSA},
December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/T10Y2YM}{10-Year Treasury
Constant Maturity Minus 2-Year Treasury Constant Maturity (T10Y2YM)}
\emph{tmaturity} \_\_Interest Rate Spreads\_ Dec 1, 2022 4:01 PM CST
Federal Reserve Bank of St.~Louis, 10-Year Treasury Constant Maturity
Minus 2-Year Treasury Constant Maturity {[}T10Y2YM{]}, retrieved from
FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/T10Y2YM}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/CUSR0000SETA02}{Consumer
Price Index for All Urban Consumers: Used Cars and Trucks in U.S. City
Average (CUSR0000SETA02)} \emph{carcpi} \_\_Consumer Price Index\_ Dec
13, 2022 7:37 AM CST U.S. Bureau of Labor Statistics, Consumer Price
Index for All Urban Consumers: Used Cars and Trucks in U.S. City Average
{[}CUSR0000SETA02{]}, retrieved from FRED, Federal Reserve Bank of
St.~Louis; \url{https://fred.stlouisfed.org/series/CUSR0000SETA02},
December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/MSACSR}{Monthly Supply of
New Houses in the United States (MSACSR)} \emph{newhouses} \_\_New
Residential Sales\_ Nov 23, 2022 9:01 AM CST U.S. Census Bureau and U.S.
Department of Housing and Urban Development, Monthly Supply of New
Houses in the United States {[}MSACSR{]}, retrieved from FRED, Federal
Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/MSACSR}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/ADPMNUSNERNSA}{Total
Nonfarm Private Payroll Employment (ADPMNUSNERNSA)} \emph{pempltot}
\_\_ADP National Employment Report\_ Nov 30, 2022 7:26 AM CST Automatic
Data Processing, Inc., Total Nonfarm Private Payroll Employment
{[}ADPMNUSNERNSA{]}, retrieved from FRED, Federal Reserve Bank of
St.~Louis; \url{https://fred.stlouisfed.org/series/ADPMNUSNERNSA},
December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/ADPMINDMANNERNSA}{Nonfarm
Private Payroll Employment for Manufacturing (ADPMINDMANNERNSA)}
\emph{pemplmanuf} \_\_ADP National Employment Report\_ Nov 30, 2022 7:26
AM CST Automatic Data Processing, Inc., Nonfarm Private Payroll
Employment for Manufacturing {[}ADPMINDMANNERNSA{]}, retrieved from
FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/ADPMINDMANNERNSA}, December 14,
2022.

\#\#\href{https://fred.stlouisfed.org/series/ADPMINDFINNERNSA}{Nonfarm
Private Payroll Employment for Financial Activities (ADPMINDFINNERNSA)}
\emph{pemplfin} \_\_ADP National Employment Report\_ Nov 30, 2022 7:26
AM CST Automatic Data Processing, Inc., Nonfarm Private Payroll
Employment for Financial Activities {[}ADPMINDFINNERNSA{]}, retrieved
from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/ADPMINDFINNERNSA}, December 14,
2022.

\#\#\href{https://fred.stlouisfed.org/series/CIVPART}{Labor Force
Participation Rate (CIVPART)} \emph{laborpart} \_\_Employment
Situation\_ Dec 2, 2022 7:44 AM CST U.S. Bureau of Labor Statistics,
Labor Force Participation Rate {[}CIVPART{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/CIVPART}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/AWHMAN}{Average Weekly
Hours of Production and Nonsupervisory Employees, Manufacturing
(AWHMAN)} \emph{prodmanuf} \_\_Employment Situation\_ Dec 2, 2022 7:45
AM CST U.S. Bureau of Labor Statistics, Average Weekly Hours of
Production and Nonsupervisory Employees, Manufacturing {[}AWHMAN{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/AWHMAN}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/AWOTMAN}{Average Weekly
Overtime Hours of Production and Nonsupervisory Employees, Manufacturing
(AWOTMAN)} \emph{overmanuf} \_\_Employment Situation\_ Dec 2, 2022 7:45
AM CST U.S. Bureau of Labor Statistics, Average Weekly Overtime Hours of
Production and Nonsupervisory Employees, Manufacturing {[}AWOTMAN{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/AWOTMAN}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/CES3000000008}{Average
Hourly Earnings of Production and Nonsupervisory Employees,
Manufacturing (CES3000000008)} \emph{wagemanuf} \_\_Employment
Situation\_ Dec 2, 2022 7:45 AM CST U.S. Bureau of Labor Statistics,
Average Hourly Earnings of Production and Nonsupervisory Employees,
Manufacturing {[}CES3000000008{]}, retrieved from FRED, Federal Reserve
Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/CES3000000008}, December 14,
2022.

\#\#\href{https://fred.stlouisfed.org/series/MTSDS133FMS}{Federal
Surplus or Deficit {[}-{]} (MTSDS133FMS)} \emph{fedsurplus} \_\_Monthly
Treasury Statement\_ Dec 12, 2022 2:03 PM CST U.S. Department of the
Treasury. Fiscal Service, Federal Surplus or Deficit {[}-{]}
{[}MTSDS133FMS{]}, retrieved from FRED, Federal Reserve Bank of
St.~Louis; \url{https://fred.stlouisfed.org/series/MTSDS133FMS},
December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/IPB50001N}{Industrial
Production: Total Index (IPB50001N)} \emph{industry} \_\_G.17 Industrial
Production and Capacity Utilization\_ Nov 16, 2022 8:19 AM CST Board of
Governors of the Federal Reserve System (US), Industrial Production:
Total Index {[}IPB50001N{]}, retrieved from FRED, Federal Reserve Bank
of St.~Louis; \url{https://fred.stlouisfed.org/series/IPB50001N},
December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/IPCONGD}{Industrial
Production: Consumer Goods (IPCONGD)} \emph{industrycg} \_\_G.17
Industrial Production and Capacity Utilization\_ Nov 16, 2022 8:18 AM
CST Board of Governors of the Federal Reserve System (US), Industrial
Production: Consumer Goods {[}IPCONGD{]}, retrieved from FRED, Federal
Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/IPCONGD}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/IPG2211A2N}{Industrial
Production: Utilities: Electric and Gas Utilities (NAICS = 2211,2)
(IPG2211A2N)} \emph{industryut} \_\_G.17 Industrial Production and
Capacity Utilization\_ Nov 16, 2022 8:19 AM CST Board of Governors of
the Federal Reserve System (US), Industrial Production: Utilities:
Electric and Gas Utilities (NAICS = 2211,2) {[}IPG2211A2N{]}, retrieved
from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/IPG2211A2N}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/MCUMFN}{Capacity
Utilization: Manufacturing (NAICS) (MCUMFN)} \emph{caput} \_\_G.17
Industrial Production and Capacity Utilization\_ Nov 16, 2022 8:18 AM
CST Board of Governors of the Federal Reserve System (US), Capacity
Utilization: Manufacturing (NAICS) {[}MCUMFN{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/MCUMFN}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/CPIHOSSL}{Consumer Price
Index for All Urban Consumers: Housing in U.S. City Average (CPIHOSSL)}
\emph{hcpiurban} \_\_Consumer Price Index\_ Dec 13, 2022 7:39 AM CST
U.S. Bureau of Labor Statistics, Consumer Price Index for All Urban
Consumers: Housing in U.S. City Average {[}CPIHOSSL{]}, retrieved from
FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/CPIHOSSL}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/CUSR0000SAC}{Consumer Price
Index for All Urban Consumers: Commodities in U.S. City Average
(CUSR0000SAC)} \emph{stuffcpi} \_\_Consumer Price Index\_ Dec 13, 2022
7:39 AM CST U.S. Bureau of Labor Statistics, Consumer Price Index for
All Urban Consumers: Commodities in U.S. City Average {[}CUSR0000SAC{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/CUSR0000SAC}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/RSXFS}{Advance Retail
Sales: Retail Trade (RSXFS)} \emph{retail} \_\_Advance Monthly Sales for
Retail and Food Services\_ Nov 16, 2022 7:34 AM CST U.S. Census Bureau,
Advance Retail Sales: Retail Trade {[}RSXFS{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/RSXFS}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/TOTBUSSMSA}{Total Business
Sales (TOTBUSSMSA)} \emph{sales} \_\_Manufacturing and Trade Inventories
and Sales\_ Nov 16, 2022 9:01 AM CST U.S. Census Bureau, Total Business
Sales {[}TOTBUSSMSA{]}, retrieved from FRED, Federal Reserve Bank of
St.~Louis; \url{https://fred.stlouisfed.org/series/TOTBUSSMSA}, December
13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/MNFCTRSMSA}{Manufacturers
Sales (MNFCTRSMSA)} \emph{manufsales} \_\_Manufacturing and Trade
Inventories and Sales\_ Nov 16, 2022 9:01 AM CST U.S. Census Bureau,
Manufacturers Sales {[}MNFCTRSMSA{]}, retrieved from FRED, Federal
Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/MNFCTRSMSA}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/MNFCTRIMSA}{Manufacturers
Inventories (MNFCTRIMSA)} \emph{manufinv} \_\_Manufacturing and Trade
Inventories and Sales\_ Nov 16, 2022 9:01 AM CST U.S. Census Bureau,
Manufacturers Inventories {[}MNFCTRIMSA{]}, retrieved from FRED, Federal
Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/MNFCTRIMSA}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/HQMCB30YRP}{30-Year High
Quality Market (HQM) Corporate Bond Par Yield (HQMCB30YRP)}
\emph{cbpy30} \_\_Corporate Bond Yield Curve\_ Dec 10, 2022 2:33 PM CST
U.S. Department of the Treasury, 30-Year High Quality Market (HQM)
Corporate Bond Par Yield {[}HQMCB30YRP{]}, retrieved from FRED, Federal
Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/HQMCB30YRP}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/FEDFUNDS}{Federal Funds
Effective Rate (FEDFUNDS)} \emph{fedfundseff} \_\_H.15 Selected Interest
Rates\_ Dec 1, 2022 3:18 PM CST Board of Governors of the Federal
Reserve System (US), Federal Funds Effective Rate {[}FEDFUNDS{]},
retrieved from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/FEDFUNDS}, December 13, 2022.

\#\#\href{https://fred.stlouisfed.org/series/GS1}{Market Yield on U.S.
Treasury Securities at 1-Year Constant Maturity, Quoted on an Investment
Basis (GS1)} \emph{treasurymat1} \_\_H.15 Selected Interest Rates\_ Dec
1, 2022 3:17 PM CST Board of Governors of the Federal Reserve System
(US), Market Yield on U.S. Treasury Securities at 1-Year Constant
Maturity, Quoted on an Investment Basis {[}GS1{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/GS1}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/GS5}{Market Yield on U.S.
Treasury Securities at 5-Year Constant Maturity, Quoted on an Investment
Basis (GS5)} \emph{treasurymat5} \_\_H.15 Selected Interest Rates\_ Dec
1, 2022 3:17 PM CST Board of Governors of the Federal Reserve System
(US), Market Yield on U.S. Treasury Securities at 5-Year Constant
Maturity, Quoted on an Investment Basis {[}GS5{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/GS5}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/GS7}{Market Yield on U.S.
Treasury Securities at 7-Year Constant Maturity, Quoted on an Investment
Basis (GS7)} \emph{treasurymat7} \_\_H.15 Selected Interest Rates\_ Dec
1, 2022 3:17 PM CST Board of Governors of the Federal Reserve System
(US), Market Yield on U.S. Treasury Securities at 7-Year Constant
Maturity, Quoted on an Investment Basis {[}GS7{]}, retrieved from FRED,
Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/GS7}, December 14, 2022.

\#\#\href{https://fred.stlouisfed.org/series/GS10}{Market Yield on U.S.
Treasury Securities at 10-Year Constant Maturity, Quoted on an
Investment Basis (GS10)} \emph{treasurymat10} \_\_H.15 Selected Interest
Rates\_ Dec 1, 2022 3:17 PM CST Board of Governors of the Federal
Reserve System (US), Market Yield on U.S. Treasury Securities at 10-Year
Constant Maturity, Quoted on an Investment Basis {[}GS10{]}, retrieved
from FRED, Federal Reserve Bank of St.~Louis;
\url{https://fred.stlouisfed.org/series/GS10}, December 13, 2022.

\#\#\href{https://trends.google.com/trends/explore?q=new\%20cars\&geo=US-WA-819}{Google
Search: new cars} \emph{g\_new\_cars} \_\_Search term in US-WA-819\_ Dec
14, 2022 9:11 AM Google Trends, {[}Google Search: new cars{]}, retrieved
from Google Trends, \url{https://www.google.com/trends}, Dec 14, 2022

\#\#\href{https://trends.google.com/trends/explore?q=used\%20cars\&geo=US-WA-819}{Google
Search: used cars} \emph{g\_used\_cars} \_\_Search term in US-WA-819\_
Dec 14, 2022 9:11 AM Google Trends, {[}Google Search: used cars{]},
retrieved from Google Trends, \url{https://www.google.com/trends}, Dec
14, 2022

\#\#\href{https://trends.google.com/trends/explore?q=cars\%20for\%20sale\&geo=US-WA-819}{Google
Search: cars for sale} \emph{g\_cars\_for\_sale} \_\_Search term in
US-WA-819\_ Dec 14, 2022 9:11 AM Google Trends, {[}Google Search: cars
for sale{]}, retrieved from Google Trends,
\url{https://www.google.com/trends}, Dec 14, 2022

\#\#\href{https://trends.google.com/trends/explore?q=car\%20for\%20sale\%20near\%20me\&geo=US-WA-819}{Google
Search: car for sale near me} \emph{g\_car\_for\_sale\_near\_me}
\_\_Search term in US-WA-819\_ Dec 14, 2022 9:11 AM Google Trends,
{[}Google Search: car for sale near me{]}, retrieved from Google Trends,
\url{https://www.google.com/trends}, Dec 14, 2022

\#\#\href{https://trends.google.com/trends/explore?q=best\%20new\%20cars\&geo=US-WA-819}{Google
Search: best new cars} \emph{g\_best\_new\_cars} \_\_Search term in
US-WA-819\_ Dec 14, 2022 9:11 AM Google Trends, {[}Google Search: best
new cars{]}, retrieved from Google Trends,
\url{https://www.google.com/trends}, Dec 14, 2022

\#\#\href{https://trends.google.com/trends/explore?q=how\%20to\%20buy\%20a\%20car\&geo=US-WA-819}{Google
Search: how to buy a car} \emph{g\_how\_to\_buy\_a\_car} \_\_Search term
in US-WA-819\_ Dec 14, 2022 9:11 AM Google Trends, {[}Google Search: how
to buy a car{]}, retrieved from Google Trends,
\url{https://www.google.com/trends}, Dec 14, 2022

\#\#\href{https://trends.google.com/trends/explore?q=dealership\%20near\%20me\&geo=US-WA-819}{Google
Search: dealership near me} \emph{g\_dealership\_near\_me} \_\_Search
term in US-WA-819\_ Dec 14, 2022 9:11 AM Google Trends, {[}Google
Search: dealership near me{]}, retrieved from Google Trends,
\url{https://www.google.com/trends}, Dec 14, 2022

\#\#\href{https://trends.google.com/trends/explore?q=dealerships\%20near\%20me\&geo=US-WA-819}{Google
Search: dealerships near me} \emph{g\_dealerships\_near\_me} \_\_Search
term in US-WA-819\_ Dec 14, 2022 9:11 AM Google Trends, {[}Google
Search: dealerships near me{]}, retrieved from Google Trends,
\url{https://www.google.com/trends}, Dec 14, 2022

\hypertarget{references}{%
\section{References}\label{references}}

\hypertarget{credit}{%
\section{Credit}\label{credit}}

Author: Keaton Markey Version: 0.11 Date Revised: 1/11/2023 Property of:
Lee Johnson Auto Family, Kirkland WA

\end{document}
